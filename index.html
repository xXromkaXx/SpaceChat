<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpaceChat - Міжпланетний чат</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: radial-gradient(ellipse at bottom, #0d1a2d 0%, #000 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .stars, .stars2, .stars3 {
            position: fixed;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            background: transparent;
            box-shadow:
                    100px 200px white, 300px 400px white, 150px 250px white,
                    500px 100px white, 700px 300px white, 900px 200px white,
                    1200px 500px white, 400px 600px white, 800px 700px white,
                    600px 150px white, 200px 800px white, 1000px 900px white;
            animation: animStar 100s linear infinite;
            z-index: 0;
        }

        .stars2 {
            width: 2px;
            height: 2px;
            box-shadow:
                    50px 150px #fff, 200px 300px #fff, 350px 100px #fff,
                    600px 400px #fff, 850px 250px #fff, 1100px 600px #fff,
                    1300px 200px #fff, 400px 900px #fff, 700px 800px #fff;
            animation: animStar 200s linear infinite;
        }

        .stars3 {
            width: 3px;
            height: 3px;
            box-shadow:
                    80px 220px #fff, 260px 360px #fff, 500px 200px #fff,
                    750px 100px #fff, 1050px 400px #fff, 1250px 700px #fff,
                    1400px 300px #fff;
            animation: animStar 300s linear infinite;
        }

        @keyframes animStar {
            from { transform: translateY(0px); }
            to { transform: translateY(-1000px); }
        }

        .comet {
            position: absolute;
            top: 50px;
            left: -200px;
            width: 150px;
            height: 2px;
            background: linear-gradient(90deg, white, transparent);
            animation: fly 10s linear infinite;
        }

        @keyframes fly {
            0% { transform: translateX(0) translateY(0); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateX(1200px) translateY(300px); opacity: 0; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            flex: 1;
        }

        header {
            background: rgba(0, 20, 40, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(80, 130, 200, 0.3);
            margin-bottom: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo h1 {
            font-size: 32px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
            letter-spacing: 1px;
        }

        .user-panel {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .login-section {
            background: rgba(0, 20, 40, 0.6);
            border-radius: 12px;
            padding: 30px;
            margin: 50px auto;
            max-width: 500px;
            text-align: center;
            border: 1px solid rgba(80, 130, 200, 0.2);
        }

        .login-section h2 {
            margin-bottom: 20px;
            color: #4facfe;
        }

        .login-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 20px;
            border: none;
            background: rgba(0, 20, 40, 0.8);
            color: white;
            outline: none;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
        }

        .chat-container {
            display: flex;
            flex: 1;
            gap: 20px;
            height: 70vh;
            display: none;
        }

        .online-users {
            width: 250px;
            background: rgba(0, 20, 40, 0.6);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(80, 130, 200, 0.2);
        }

        .online-users h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(80, 130, 200, 0.3);
            color: #4facfe;
        }

        .user-list {
            list-style: none;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(79, 172, 254, 0.1);
        }

        .user-avatar-sm {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0, 20, 40, 0.6);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(80, 130, 200, 0.2);
        }

        .chat-header {
            padding: 15px 20px;
            background: rgba(0, 30, 60, 0.7);
            border-bottom: 1px solid rgba(80, 130, 200, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 18px;
            color: #4facfe;
        }

        .user-count {
            font-size: 14px;
            color: #00f2fe;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            max-width: 80%;
        }

        .message.received {
            align-self: flex-start;
        }

        .message.sent {
            align-self: flex-end;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            margin: 0 10px;
            position: relative;
        }

        .received .message-content {
            background: rgba(79, 172, 254, 0.2);
            border-top-left-radius: 4px;
        }

        .sent .message-content {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-top-right-radius: 4px;
        }

        .message-sender {
            font-size: 12px;
            margin-bottom: 4px;
            color: #00f2fe;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
            text-align: right;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background: rgba(0, 30, 60, 0.7);
            border-top: 1px solid rgba(80, 130, 200, 0.3);
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 20px;
            border: none;
            background: rgba(0, 20, 40, 0.8);
            color: white;
            outline: none;
        }

        .chat-input button {
            margin-left: 10px;
            padding: 12px 20px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(79, 172, 254, 0.4);
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #00ff9d;
            border-radius: 50%;
            margin-left: auto;
        }

        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 20px;
            border-top: 1px solid rgba(80, 130, 200, 0.3);
        }

        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-connected {
            background: #00ff9d;
        }

        .status-disconnected {
            background: #ff4d4d;
        }

        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
            }

            .online-users {
                width: 100%;
                height: 150px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
<div class="stars"></div>
<div class="stars2"></div>
<div class="stars3"></div>
<div class="comet"></div>

<div class="container">
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>SpaceChat</h1>
            </div>
            <div class="user-panel" id="userPanel">
                <div class="user-avatar">
                    <i class="fas fa-user-astronaut"></i>
                </div>
                <div id="userInfo">
                    <div>Гість</div>
                    <div class="contact-status">Не в мережі</div>
                </div>
            </div>
        </div>
    </header>

    <div class="login-section" id="loginSection">
        <h2>Вхід до космічного чату</h2>
        <input type="text" id="usernameInput" class="login-input" placeholder="Введіть ваше ім'я">
        <button id="loginBtn" class="login-btn">Увійти до чату</button>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="online-users">
            <h3>Космонавти онлайн</h3>
            <ul class="user-list" id="userList">
                <li class="user-item">
                    <div class="user-avatar-sm">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div>Центр управління</div>
                    <div class="online-indicator"></div>
                </li>
            </ul>
        </div>

        <div class="chat-main">
            <div class="chat-header">
                <div class="chat-title">Загальний космічний чат</div>
                <div class="user-count"><span id="onlineCount">1</span> космонавт(ів) онлайн</div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div class="message-content">
                        <div class="message-sender">Центр управління</div>
                        <div>Ласкаво просимо до космічного чату! Тут ви можете спілкуватися з іншими космонавтами в реальному часі.</div>
                        <div class="message-time">10:00</div>
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Напишіть повідомлення...">
                <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2023 SpaceChat. Космічний чат для справжніх астронавтів</p>
    </footer>

    <div class="connection-status" id="connectionStatus">
        <div class="status-indicator status-disconnected"></div>
        <span>Відключено</span>
    </div>
</div>

<script>
    // Конфігурація Firebase (замініть на свою)
    const firebaseConfig = {
        apiKey: "AIzaSyD7VL448wuUgDLU1F5vnmN-bc1CC0r3vgM",
        authDomain: "spacechat-624bf.firebaseapp.com",
        projectId: "spacechat-624bf",
        storageBucket: "spacechat-624bf.firebasestorage.app",
        messagingSenderId: "309487888962",
        appId: "1:309487888962:web:e61a9dcfdd03bb42e59bdb",
        measurementId: "G-4H78V9FXKM"
    };


    // Ініціалізація Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.addEventListener('DOMContentLoaded', function() {
        const loginSection = document.getElementById('loginSection');
        const chatContainer = document.getElementById('chatContainer');
        const usernameInput = document.getElementById('usernameInput');
        const loginBtn = document.getElementById('loginBtn');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendMessage');
        const chatMessages = document.getElementById('chatMessages');
        const userList = document.getElementById('userList');
        const onlineCount = document.getElementById('onlineCount');
        const userInfo = document.getElementById('userInfo');
        const connectionStatus = document.getElementById('connectionStatus');

        let username = '';
        let users = [];
        let unsubscribeMessages = null;
        let unsubscribeUsers = null;

        // Функція для оновлення статусу підключення
        function updateConnectionStatus(connected) {
            const indicator = connectionStatus.querySelector('.status-indicator');
            const text = connectionStatus.querySelector('span');

            if (connected) {
                indicator.className = 'status-indicator status-connected';
                text.textContent = 'Підключено';
            } else {
                indicator.className = 'status-indicator status-disconnected';
                text.textContent = 'Відключено';
            }
        }

        // Функція для додавання нового повідомлення
        function addMessage(sender, text, isCurrentUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isCurrentUser ? 'sent' : 'received'}`;

            const now = new Date();
            const timeString = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;

            messageDiv.innerHTML = `
                    <div class="message-content">
                        ${!isCurrentUser ? `<div class="message-sender">${sender}</div>` : ''}
                        <div>${text}</div>
                        <div class="message-time">${timeString}</div>
                    </div>
                `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Функція для відправки повідомлення
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                // Додаємо повідомлення в Firestore
                db.collection('messages').add({
                    sender: username,
                    text: message,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).catch(error => {
                    console.error('Помилка відправки повідомлення: ', error);
                });

                messageInput.value = '';
            }
        }

        // Функція для оновлення списку користувачів
        function updateUserList(usersArray) {
            userList.innerHTML = '';

            usersArray.forEach(user => {
                const userItem = document.createElement('li');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                        <div class="user-avatar-sm">
                            <i class="fas fa-user-astronaut"></i>
                        </div>
                        <div>${user}</div>
                        <div class="online-indicator"></div>
                    `;
                userList.appendChild(userItem);
            });

            onlineCount.textContent = usersArray.length;
        }

        // Прослуховування змін у колекції повідомлень
        function setupMessagesListener() {
            unsubscribeMessages = db.collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'added') {
                            const data = change.doc.data();
                            addMessage(data.sender, data.text, data.sender === username);
                        }
                    });
                }, error => {
                    console.error('Помилка отримання повідомлень: ', error);
                });
        }

        // Прослуховування змін у колекції користувачів
        function setupUsersListener() {
            unsubscribeUsers = db.collection('users')
                .onSnapshot(snapshot => {
                    const usersArray = [];
                    snapshot.forEach(doc => {
                        usersArray.push(doc.id);
                    });
                    updateUserList(usersArray);
                }, error => {
                    console.error('Помилка отримання списку користувачів: ', error);
                });
        }

        // Обробка входу в чат
        loginBtn.addEventListener('click', function() {
            username = usernameInput.value.trim();
            if (username) {
                // Додаємо користувача до Firestore
                db.collection('users').doc(username).set({
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    loginSection.style.display = 'none';
                    chatContainer.style.display = 'flex';
                    userInfo.querySelector('div').textContent = username;
                    userInfo.querySelector('.contact-status').textContent = 'В мережі';

                    // Налаштовуємо прослуховувачі
                    setupMessagesListener();
                    setupUsersListener();

                    // Оновлюємо статус підключення
                    updateConnectionStatus(true);

                    // Додаємо системне повідомлення про підключення
                    db.collection('messages').add({
                        sender: 'Система',
                        text: `${username} приєднався до чату`,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }).catch(error => {
                    console.error('Помилка додавання користувача: ', error);
                    alert('Помилка входу в чат. Спробуйте інше ім\'я.');
                });
            }
        });

        // Обробка відправки повідомлення
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Оновлення часу останньої активності користувача
        function updateUserActivity() {
            if (username) {
                db.collection('users').doc(username).update({
                    lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        }

        // Оновлюємо активність кожні 30 секунд
        setInterval(updateUserActivity, 30000);

        // Видаляємо користувача при закритті сторінки
        window.addEventListener('beforeunload', function() {
            if (username) {
                // Відписуємося від слухачів
                if (unsubscribeMessages) unsubscribeMessages();
                if (unsubscribeUsers) unsubscribeUsers();

                // Видаляємо користувача
                db.collection('users').doc(username).delete();

                // Додаємо системне повідомлення про відключення
                db.collection('messages').add({
                    sender: 'Система',
                    text: `${username} покинув чат`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        });

        // Перевірка підключення до Firebase
        firebase.firestore().enableNetwork()
            .then(() => {
                console.log("Підключено до Firebase");
            })
            .catch((error) => {
                console.error("Помилка підключення: ", error);
                updateConnectionStatus(false);
            });
    });
</script>
</body>
</html>